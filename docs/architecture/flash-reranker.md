# Flash Reranker

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É agentic reranker –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ RAG-–∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤.

## –û–±–∑–æ—Ä

Flash Reranker ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç RAG pipeline, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM (Gemini Flash) –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–±–æ—Ä–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç–æ–ø–∏–∫–æ–≤ –∏ –ª—é–¥–µ–π –∏–∑ –ø–∞–º—è—Ç–∏.

**–ü—Ä–æ–±–ª–µ–º–∞:** Vector search –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Top-50 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–æ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–º—É —Å—Ö–æ–¥—Å—Ç–≤—É, –Ω–æ:
- –í—Å–µ 50 –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –≤–ª–µ–∑—É—Ç (~100K —Ç–æ–∫–µ–Ω–æ–≤)
- –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
- –ù–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –ª—é–¥—å–º–∏, –ø—Ä–æ–µ–∫—Ç–∞–º–∏, —Å–æ–±—ã—Ç–∏—è–º–∏

**–†–µ—à–µ–Ω–∏–µ:** Agentic reranker ‚Äî Flash —Å–∞–º –∏–∑—É—á–∞–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      RETRIEVAL PIPELINE                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  1. CONTEXTUALIZED QUERY (Flash)                                ‚îÇ
‚îÇ  2. VECTOR SEARCH ‚Üí Top-50 candidates (summaries only)          ‚îÇ
‚îÇ  3. FLASH RERANKER (agentic):                                   ‚îÇ
‚îÇ     Turn 1: Flash –ø–æ–ª—É—á–∞–µ—Ç 50 summaries (~3K tokens)            ‚îÇ
‚îÇ             Flash –≤—ã–∑—ã–≤–∞–µ—Ç get_topics_content([ids])            ‚îÇ
‚îÇ     Turn 2: Flash –ø–æ–ª—É—á–∞–µ—Ç full content –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö —Ç–æ–ø–∏–∫–æ–≤     ‚îÇ
‚îÇ             Flash –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –≤—ã–±–æ—Ä–æ–º           ‚îÇ
‚îÇ  4. CONTEXT ASSEMBLY —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ç–æ–ø–∏–∫–∞–º–∏                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Agentic Flow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Turn 1: Initial Request                                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ System: Reranker prompt                                          ‚îÇ
‚îÇ User:                                                            ‚îÇ
‚îÇ   - –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞                                                 ‚îÇ
‚îÇ   - Contextualized Query (—Å—É—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞)                        ‚îÇ
‚îÇ   - –¢–µ–∫—É—â–∞—è –ø–∞—á–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                      ‚îÇ
‚îÇ   - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (key facts)                             ‚îÇ
‚îÇ   - 50 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (ID | –î–∞—Ç–∞ | –†–∞–∑–º–µ—Ä | –¢–µ–º–∞)                    ‚îÇ
‚îÇ Tools: get_topics_content(ids: int[])                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Response 1: Tool Call                                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ get_topics_content([42, 18, 5, 12, 7, 33, 8, 15, 21, 44])        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Turn 2: Tool Result                                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Full content of 10 topics (~25K tokens)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Response 2: Final JSON                                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ {"topics": [42, 18, 5], "people": []}                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –ü–æ—á–µ–º—É Agentic –ø–æ–¥—Ö–æ–¥

| –ü–æ–¥—Ö–æ–¥ | –¢–æ–∫–µ–Ω—ã | –ü—Ä–æ–±–ª–µ–º–∞ |
|--------|--------|----------|
| Full-content | 50 √ó ~2K = 100K+ | –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤ |
| Two-stage | 3K + 30K | –ú—ã —Ä–µ—à–∞–µ–º —á—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å, –Ω–µ Flash |
| **Agentic** | 3K + (N √ó ~2K) | Flash —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç, –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ |

–ê–Ω–∞–ª–∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (1225 —Ç–æ–ø–∏–∫–æ–≤):
- 79% —Ç–æ–ø–∏–∫–æ–≤ ‚â§ 2K —Ç–æ–∫–µ–Ω–æ–≤
- –ú–µ–¥–∏–∞–Ω–∞: 500-1K —Ç–æ–∫–µ–Ω–æ–≤
- –ì–∏–≥–∞–Ω—Ç—ã (>10K): —Ç–æ–ª—å–∫–æ 1%

–¢–∏–ø–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: Flash –∑–∞–ø—Ä–æ—Å–∏—Ç 10-15 —Ç–æ–ø–∏–∫–æ–≤ (~25K —Ç–æ–∫–µ–Ω–æ–≤) –≤–º–µ—Å—Ç–æ –≤—Å–µ—Ö 50.

### –ü–æ—á–µ–º—É Unified Reranker (Topics + People)

–í v0.5 –ø–æ—è–≤–∏—Ç—Å—è People table (—Å–æ—Ü–∏–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ). –õ—é–¥–∏ –∏ —Ç–æ–ø–∏–∫–∏ —Å–≤—è–∑–∞–Ω—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º:

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:** "–ü–æ–º–Ω–∏—à—å –ü–µ—Ç—Ä–æ–≤–∞ –∏–∑ ProjectX?"
- –ù—É–∂–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å –ü–µ—Ç—Ä–æ–≤–∞ (People)
- –ù—É–∂–Ω—ã —Ç–æ–ø–∏–∫–∏ –≥–¥–µ –æ–±—Å—É–∂–¥–∞–ª–∏ ProjectX, –º–∏—Ç–∏–Ω–≥–∏, –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∏

–û–¥–∏–Ω reranker –≤–∏–¥–∏—Ç –≤—Å–µ—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –º–∏–∫—Å.
–†–∞–∑–¥–µ–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã: 0-5 —Ç–æ–ø–∏–∫–æ–≤, 0-10 –ª—é–¥–µ–π.

### –ü–æ—á–µ–º—É Batch Tools

```go
// –•–æ—Ä–æ—à–æ: –æ–¥–∏–Ω –≤—ã–∑–æ–≤
get_topics_content([42, 18, 5, 12, 7])

// –ü–ª–æ—Ö–æ: 5 round-trips
get_topics_content([42])
get_topics_content([18])
get_topics_content([5])
...
```

Flash –≤—ã–±–∏—Ä–∞–µ—Ç batch –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è ‚Üí 2 round-trips –≤–º–µ—Å—Ç–æ 10+.

### –ü–æ—á–µ–º—É JSON + Response Healing

OpenRouter Response Healing plugin –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç:
- JSON –≤ markdown –±–ª–æ–∫–∞—Ö
- –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- –ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π —Ç–µ–∫—Å—Ç –≤–æ–∫—Ä—É–≥ JSON

```go
Plugins: []openrouter.Plugin{{ID: "response-healing"}},
ResponseFormat: openrouter.ResponseFormat{Type: "json_object"},
```

## –§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö

### –§–æ—Ä–º–∞—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ (summary)

```
[ID:42] 2025-07-25 | 20 msgs, ~16K chars | –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ ML-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–∞ H100
[ID:18] 2025-12-21 | 172 msgs, ~47K chars | –û–±—Å—É–∂–¥–µ–Ω–∏–µ –∫–æ–ª–ª–µ–≥–∏ –ú–∞—Ä–∏–∏
[ID:5]  2026-01-02 | 3 msgs, ~800 chars | –ë—ã—Å—Ç—Ä—ã–π –≤–æ–ø—Ä–æ—Å –ø—Ä–æ Docker
```

–†–∞–∑–º–µ—Ä –≤ —Å–∏–º–≤–æ–ª–∞—Ö –ø–æ–º–æ–≥–∞–µ—Ç Flash –æ—Ü–µ–Ω–∏—Ç—å "–≤–µ—Å" —Ç–æ–ø–∏–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π.

### –§–æ—Ä–º–∞—Ç tool result (full content)

```
=== Topic 42 ===
–î–∞—Ç–∞: 2025-07-25 | 20 msgs | ~16K chars
–¢–µ–º–∞: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ ML-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–∞ H100, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ vLLM –¥–ª—è Qwen3

[User (@username) (2025-07-25 14:30:00)]: –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å vLLM –Ω–∞ H100?
[Assistant]: –î–ª—è H100 —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —Å–ª–µ–¥—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...
[–ü–µ—Ä–µ—Å–ª–∞–Ω–æ –æ—Ç –ü–µ—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º User –≤ 2025-07-25 14:35:00]: –ê —É –Ω–∞—Å —Ç–∞–∫–∏–µ –∂–µ –ø—Ä–æ–±–ª–µ–º—ã
[User (@username) (2025-07-25 14:36:00)]: –î–∞, –ø–æ–º–Ω—é –ü–µ—Ç—Ä–æ–≤–∞

=== Topic 18 ===
–î–∞—Ç–∞: 2025-12-21 | 172 msgs | ~47K chars
–¢–µ–º–∞: –û–±—Å—É–∂–¥–µ–Ω–∏–µ –∫–æ–ª–ª–µ–≥–∏ –ú–∞—Ä–∏–∏ –∏ –µ—ë —Ä–∞–±–æ—Ç—ã —Å –ê–Ω–Ω–æ–π
...
```

### –§–æ—Ä–º–∞—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

**v0.4.2+:** –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å reason –∏ excerpt:

```json
{
  "topics": [
    {"id": 42, "reason": "–û–±—Å—É–∂–¥–µ–Ω–∏–µ vLLM –Ω–∞ H100 ‚Äî –ø—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å"},
    {"id": 18, "reason": "–£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ü–µ—Ç—Ä–æ–≤–∞", "excerpt": "[User]: –ü–æ–º–Ω—é –ü–µ—Ç—Ä–æ–≤–∞ –∏–∑ ProjectX...\n[Assistant]: –î–∞, –æ–Ω –∑–∞–Ω–∏–º–∞–ª—Å—è..."}
  ]
}
```

**–ü–æ–ª—è:**
- `id` ‚Äî ID —Ç–æ–ø–∏–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `reason` ‚Äî –∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) –ø–æ—á–µ–º—É –≤—ã–±—Ä–∞–Ω (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `excerpt` ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–ø–∏–∫–æ–≤ >25K chars: Flash –≤—ã—Ä–µ–∑–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–ó–∞—á–µ–º excerpt:**
- –¢–æ–ø–∏–∫–∏ >25K chars ‚Äî —Ä–µ–¥–∫–æ—Å—Ç—å (~1%), –Ω–æ –∑–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –í–º–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª–Ω–æ–≥–æ —Ç–æ–ø–∏–∫–∞ (~50K tokens), Flash –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (~2-5K)
- –§–æ—Ä–º–∞—Ç excerpt: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è `[User]: ..., [Assistant]: ...`

**–ü—Ä–∞–≤–∏–ª–∞ excerpt (v0.4.3):**
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–∞—Ä—ã User‚ÜíAssistant ‚Äî –Ω–µ –≤—ã—Ä–µ–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù–µ –æ–±—Ä–µ–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –ø–æ–ª—É—Å–ª–æ–≤–µ ‚Äî –≤–∫–ª—é—á–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
- –í–∫–ª—é—á–∞—Ç—å 1-2 —Å–æ—Å–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- Excerpt –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô –∑–∞–ø—Ä–æ—Å, –∞ –Ω–µ –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π

**Backward compatibility:** –ü–∞—Ä—Å–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç `[42, 18, 5]`

## Multimodal RAG (v0.4.5)

Flash Reranker –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç multimodal input ‚Äî –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∞—É–¥–∏–æ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ enricher –∏ reranker.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–µ–∑ multimodal RAG –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≥–æ–ª–æ—Å–æ–≤—ã—Ö/–∫–∞—Ä—Ç–∏–Ω–æ–∫:
```
User: [voice 30s] + "–æ —á—ë–º —Ç—É—Ç —Ä–µ—á—å?"
      ‚Üì
RAG –∏—â–µ—Ç "üé§ –æ —á—ë–º —Ç—É—Ç —Ä–µ—á—å?" ‚Üí –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞
```

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–¥–∞—ë–º –º–µ–¥–∏–∞ –≤ RAG pipeline:
```
User: [voice 30s] + "–æ —á—ë–º —Ç—É—Ç —Ä–µ—á—å?"
      ‚Üì
Enricher –í–ò–î–ò–¢ –∞—É–¥–∏–æ ‚Üí "–ú–∞—à–∞ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç –æ –¥–∞—á–µ, —Å–æ–±–∞–∫–µ"
      ‚Üì
Vector search: "–¥–∞—á–∞, —Å–æ–±–∞–∫–∞" ‚Üí —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–æ–ø–∏–∫–∏
      ‚Üì
Reranker –í–ò–î–ò–¢ –∞—É–¥–∏–æ + 50 —Å–∞–º–º–∞—Ä–∏ ‚Üí —Ç–æ—á–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `RetrievalOptions.MediaParts` ‚Äî slice —Å `ImagePart`, `AudioPart`, `FilePart`
- `enrichQuery()` —Å—Ç—Ä–æ–∏—Ç multimodal message –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –º–µ–¥–∏–∞
- `rerankCandidates()` –≤–∫–ª—é—á–∞–µ—Ç –º–µ–¥–∏–∞ –≤ user prompt

**Cost impact:**
| –≠—Ç–∞–ø | Audio 30s (~2K tok) | Cost |
|------|---------------------|------|
| Enricher | +2K tokens | $0.002 |
| Reranker | +2K tokens | $0.002 |
| **Extra cost per message** | ~4K tokens | **~$0.004** |

## Fallback Strategy

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ï—Å–ª–∏ Flash —É—Å–ø–µ–ª —Å–¥–µ–ª–∞—Ç—å tool call ‚Äî –µ–≥–æ –≤—ã–±–æ—Ä (requestedIDs) —Ü–µ–Ω–Ω–µ–µ —á–µ–º –≥–æ–ª—ã–π –∫–æ—Å–∏–Ω—É—Å.

| –°–∏—Ç—É–∞—Ü–∏—è | –ß—Ç–æ –µ—Å—Ç—å | –î–µ–π—Å—Ç–≤–∏–µ |
|----------|----------|----------|
| Flash –≤–µ—Ä–Ω—É–ª JSON –±–µ–∑ tools | –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä | –ü—Ä–∏–Ω—è—Ç—å |
| Flash –≤–µ—Ä–Ω—É–ª –≤–∞–ª–∏–¥–Ω—ã–π JSON –ø–æ—Å–ª–µ tools | –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä | –ü—Ä–∏–Ω—è—Ç—å |
| Tool call —Å–¥–µ–ª–∞–Ω, JSON –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π | requestedIDs | Top-5 –∏–∑ requestedIDs |
| Timeout –ø–æ—Å–ª–µ tool call | requestedIDs | Top-5 –∏–∑ requestedIDs |
| 3+ tool calls (–ª–∏–º–∏—Ç) | requestedIDs | Top-5 –∏–∑ requestedIDs |
| Timeout –¥–æ tool call | –ù–∏—á–µ–≥–æ | Vector top-5 |
| –û—à–∏–±–∫–∞ API | –ù–∏—á–µ–≥–æ | Vector top-5 |

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```go
type rerankerState struct {
    requestedIDs []int  // –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ–º –∏–∑ –≤—Å–µ—Ö tool calls
}

// –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ tool call:
state.requestedIDs = append(state.requestedIDs, toolCall.IDs...)

// –ü—Ä–∏ fallback:
if len(state.requestedIDs) > 0 {
    return state.requestedIDs[:min(5, len(state.requestedIDs))]
}
return vectorTop5
```

Flash –æ–±—ã—á–Ω–æ —Å—Ç–∞–≤–∏—Ç –±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –ø–µ—Ä–≤—ã–º–∏ –≤ –º–∞—Å—Å–∏–≤–µ ‚Äî –±–µ—Ä—ë–º –ø–µ—Ä–≤—ã–µ 5.

## Tool Schema

```json
{
  "name": "get_topics_content",
  "description": "–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–æ–ø–∏–∫–æ–≤ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è. –£—á–∏—Ç—ã–≤–∞–π —Ä–∞–∑–º–µ—Ä ‚Äî –±–æ–ª—å—à–∏–µ —Ç–æ–ø–∏–∫–∏ (>10K chars) –∑–∞–≥—Ä—É–∂–∞–π —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–µ–º–∞ –æ—á–µ–Ω—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞.",
  "parameters": {
    "type": "object",
    "properties": {
      "ids": {
        "type": "array",
        "items": {"type": "integer"},
        "description": "ID —Ç–æ–ø–∏–∫–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏"
      }
    },
    "required": ["ids"]
  }
}
```

## –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–∏–ø | Labels | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|--------|----------|
| `laplaced_reranker_duration_seconds` | histogram | user_id | –û–±—â–µ–µ –≤—Ä–µ–º—è (–≤—Å–µ turns) |
| `laplaced_reranker_tool_calls_total` | counter | user_id | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ tool calls |
| `laplaced_reranker_candidates_input` | histogram | user_id | Summaries –Ω–∞ –≤—Ö–æ–¥–µ |
| `laplaced_reranker_candidates_output` | histogram | user_id | –í—ã–±—Ä–∞–ª –≤ –∏—Ç–æ–≥–µ |
| `laplaced_reranker_cost_usd_total` | counter | user_id | –°—Ç–æ–∏–º–æ—Å—Ç—å reranker |
| `laplaced_reranker_fallback_total` | counter | user_id, reason | Fallback —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è |

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```yaml
rag:
  reranker:
    enabled: true
    model: "google/gemini-3-flash-preview"
    candidates: 50              # —Å–∫–æ–ª—å–∫–æ summaries –ø–æ–∫–∞–∑–∞—Ç—å
    max_topics: 15              # –ª–∏–º–∏—Ç —Ç–æ–ø–∏–∫–æ–≤ –≤ –≤—ã–±–æ—Ä–µ (v0.4.5: –±—ã–ª–æ 5)
    max_people: 10              # –ª–∏–º–∏—Ç –ª—é–¥–µ–π (v0.5)
    timeout: "60s"              # timeout –Ω–∞ –≤–µ—Å—å reranker flow (v0.4.5: –±—ã–ª–æ 10s)
    turn_timeout: "30s"         # timeout –Ω–∞ –∫–∞–∂–¥—ã–π LLM –≤—ã–∑–æ–≤ (v0.4.5)
    max_tool_calls: 3           # –º–∞–∫—Å–∏–º—É–º tool calls
    thinking_level: "medium"    # reasoning effort: minimal/low/medium/high (v0.4.5)
    target_context_chars: 25000 # —Ü–µ–ª–µ–≤–æ–π –±—é–¥–∂–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö (v0.4.5)
```

## –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç

| –ú–µ—Ç—Ä–∏–∫–∞ | v0.3.9 (baseline) | v0.4 (target) | v0.4 (actual) |
|---------|-------------------|---------------|---------------|
| E2E latency p95 | ~50s | ~25s | ~26s ‚úÖ |
| Context: Topics | ~24K tokens | ~5K tokens | ~7K tokens ‚úÖ |
| Cost per message | ~$0.40 | ~$0.20 | ~$0.05 ‚úÖ |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Actual —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–∞ dev (2026-01-04). –°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∏–∂–µ –æ–∂–∏–¥–∞–µ–º–æ–π –∑–∞ —Å—á—ë—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (50 ‚Üí 5 —Ç–æ–ø–∏–∫–æ–≤) –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Flash –¥–ª—è reranker.

### v0.4.2 Improvements

**Reason & Excerpt:**
- **Debuggability:** –í UI –≤–∏–¥–Ω–æ –ø–æ—á–µ–º—É Flash –≤—ã–±—Ä–∞–ª –∫–∞–∂–¥—ã–π —Ç–æ–ø–∏–∫
- **Context reduction:** –î–ª—è –≥–∏–≥–∞–Ω—Ç—Å–∫–∏—Ö —Ç–æ–ø–∏–∫–æ–≤ (>25K chars) –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–∫—Ä–∞—Ç–∏—Ç—Å—è –µ—â—ë –±–æ–ª—å—à–µ
- **Quality monitoring:** –ú–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å reasons –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤

### v0.4.3 Protocol Enforcement

**Forced Tool Calling:**
- –ù–∞ –ø–µ—Ä–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `tool_choice: {type: "function", function: {name: "get_topics_content"}}`
- Flash –û–ë–Ø–ó–ê–ù –≤—ã–∑–≤–∞—Ç—å tool –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Äî —ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—è –∏–∑—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- Gemini API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: `tool_choice` –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å `response_format: json_object`
- –†–µ—à–µ–Ω–∏–µ: `response_format` –≤–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ tool call

**Reasoning Mode:**
- –í–∫–ª—é—á—ë–Ω `reasoning.effort: "low"` –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ tool calls
- Gemini 2.5+ –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç internal thinking –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º

**Protocol Violation Detection:**
- –ï—Å–ª–∏ Flash –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –±–µ–∑ tool calls ‚Üí fallback –Ω–∞ vector top
- –ú–µ—Ç—Ä–∏–∫–∞: `laplaced_reranker_fallback_total{reason="protocol_violation"}`
- Safety net –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ `tool_choice` –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç

**Query Enrichment Fix:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ "–ù–ï –£–ì–ê–î–´–í–ê–ô" –≤ enrichment prompt
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑–∞–º–µ–Ω—É –Ω–µ–∑–Ω–∞–∫–æ–º—ã—Ö —Å–ª–æ–≤ –Ω–∞ –ø–æ—Ö–æ–∂–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
- –ü—Ä–∏–º–µ—Ä: "–º–µ–Ω–∏—Å–∫" —Ç–µ–ø–µ—Ä—å –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ "MinIO"

## –°—Å—ã–ª–∫–∏

- [ROADMAP v0.4](../plans/ROADMAP.md#1-flash-reranker-p1--main-feature)
- [Embedding Storage](./embedding-storage.md)
