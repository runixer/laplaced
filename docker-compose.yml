# Docker Compose configuration for laplaced
# 
# Usage:
#   1. Copy .env.example to .env and fill in your values
#   2. (Optional) Copy configs/config.example.yaml to configs/config.yaml and customize
#   3. Run: docker compose -f docker-compose.prod.yml up -d
#
# The bot will use embedded default configuration if configs/config.yaml is not provided.
# Environment variables in .env will override config values.

services:
  laplaced:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: laplaced
    restart: always
    
    ports:
      - "9081:9081"
    
    # Environment variables (override config values)
    env_file:
      - .env
    
    environment:
      # Non-secret environment variables
      - TZ=Europe/Moscow
      - LAPLACED_LOG_LEVEL=debug
      - LAPLACED_SERVER_DEBUG=true
      - LAPLACED_BOT_LANGUAGE=ru
      - LAPLACED_BOT_NAME=Laplaced
      - LAPLACED_BOT_SYSTEM_PROMPT_EXTRA=You are a development version (Dev Version), a testing ground.
      # - LAPLACED_OPENROUTER_MODEL=google/gemini-3-flash-preview
    
    # Volumes for persistent data and configuration
    volumes:
      # Database storage (required)
      - ./data:/data
      
      # Optional: custom configuration file
      # Uncomment if you want to use a custom config instead of embedded defaults
      # - ./configs/config.yaml:/configs/config.yaml:ro
    
    # Health check
    healthcheck:
      test: ["CMD", "/laplaced", "-healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

