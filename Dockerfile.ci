# CI Dockerfile - uses pre-built binaries
FROM --platform=$BUILDPLATFORM alpine:3.23 AS certs
RUN apk add --no-cache ca-certificates tzdata

FROM scratch

LABEL org.opencontainers.image.source="https://github.com/runixer/laplaced"
LABEL org.opencontainers.image.description="Smart Telegram bot with long-term memory"
LABEL org.opencontainers.image.licenses="MIT"

# Copy CA certificates for HTTPS
COPY --from=certs /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/

# Copy timezone data
COPY --from=certs /usr/share/zoneinfo /usr/share/zoneinfo

# Copy pre-built binary based on target architecture
ARG TARGETARCH
COPY bin/linux/${TARGETARCH}/laplaced /laplaced

ENV TZ=UTC
EXPOSE 9081

ENTRYPOINT ["/laplaced"]
